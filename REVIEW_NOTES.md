# Additional Review Notes

1. **Dedупликация запросов геокодинга и отмена гонок**. Сейчас `geocodeCities` пробегает по исходному массиву имён и для каждого имени создаёт задачу (`names.map(...)`). Если в таблице одно и то же название города встречается десятки раз, мы пойдём в Mapbox столькими же запросами. Перед запуском fetch’ей стоит нормализовать список (`new Map`/`Set` или сгруппировать по `normalizeName`) и повторно использовать промис. Дополнительно можно принимать `AbortSignal`, чтобы отменять геокодинг при смене фильтров/данных и не держать висящие запросы. Всё это разгрузит API и сделает перерисовки быстрее.

2. **Срок годности и неймспейс кэша городов**. `cityCache` складывает ответ в `localStorage` без тайм-ту-лив и без привязки к access token. Если пользователь переключится на другой токен или мы поправим географию в бэке, браузер будет возвращать устаревшие координаты. Добавьте timestamp и TTL (например, неделя) и включите токен в ключ (`coffee_city_cache_v1_${tokenSuffix}`), чтобы можно было «проталкивать» свежие ответы без ручной чистки storage.

3. **Плавность fitBounds и reduce motion**. `fitToData` всегда анимирует перелёт 700 мс (`map.fitBounds(... { duration: 700 })`), даже если у пользователя включён `prefers-reduced-motion`. Можно проверять `window.matchMedia('(prefers-reduced-motion: reduce)')` и при true сбрасывать `duration` до нуля или уменьшать, а заодно учитывать маленькие экраны (доп. padding). Это даст бонус к UX и снизит тошнотворный эффект на части аудитории.

4. **Улучшить навигацию в попапе с несколькими точками**. Сейчас `showMultiPopup` каждый раз пересоздаёт HTML и вешает обработчики стрелок с `setTimeout`, из-за чего при быстром переключении создаются лишние лиснеры. Можно отрендерить кнопки один раз, использовать делегирование (`popup.getElement().addEventListener('click', ...)`) и добавить клавиатурное управление (стрелки влево/вправо, Escape). Пользовательский опыт станет лучше, а лишних GC-пауз станет меньше.
