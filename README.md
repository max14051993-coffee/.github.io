# .github.io
Coffeemap-mapbox-googleshhets

## Structure
- `index.html` – main entry point
- `css/style.css` – extracted styles
- `js/app.js` – extracted scripts
- `js/photo-import.js` – модуль распознавания данных с фото и подготовки отправки в Google форму
- `js/config.js` – параметры подключения к Google форме для автозаполнения

## Фото-импорт: как это работает

1. Откройте страницу и загрузите фото этикетки или карточки кофе в блоке «Загрузка по фото».
2. Tesseract.js (загружается с CDN `cdn.jsdelivr.net`) распознаёт текст на русском и английском и выводит его в поле ниже.
3. Скрипт автоматически пытается разбить текст на поля (название, ростер и т.д.). Поля можно исправить вручную — это не считается ошибкой.
4. Нажмите «Скопировать данные» или «Отправить в Google Docs», чтобы использовать распознанный текст.

### Почему может появляться ошибка распознавания

- Файл не выбран, повреждён или в формате, который не поддерживается браузером.
- Страница не может загрузить библиотеку Tesseract.js с CDN (офлайн-режим, блокировка домена, строгие политики контента).
- Фото нечёткое, с бликами, перевёрнуто или содержит слишком мало контрастного текста.
- Производительность устройства не позволяет завершить OCR (особенно на больших изображениях).

В таких ситуациях интерфейс показывает «Не удалось распознать изображение. Попробуйте другое фото.» Дополнительные детали выводятся в консоль браузера как `OCR error`.

### Настройка Google формы

Отправка в Google форму не влияет на распознавание. Если параметры не заданы, кнопка отправки будет неактивной, а рядом появится подсказка настроить `js/config.js`.

Чтобы включить автозаполнение формы:

1. Создайте Google Form, связанную с нужной таблицей.
2. В режиме предзаполнения скопируйте идентификаторы `entry.xxxxx` для вопросов.
3. Отредактируйте `js/config.js`:
   - `enabled: true` — включить интеграцию.
   - `prefillBaseUrl` — ссылка вида `https://docs.google.com/forms/d/e/.../viewform`.
  - `entryMap` — сопоставление ключей `coffeeName`, `roasterName`, `country`, `region`, `farm`, `process`, `brewMethod`, `notes`, `rawText` с идентификаторами полей формы.
   - при необходимости укажите `extraParams` (по умолчанию `usp=pp_url`).

После этого кнопка «Отправить в Google Docs» откроет форму с уже подставленными данными.
