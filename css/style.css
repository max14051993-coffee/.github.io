    html,body,#map{height:100%;margin:0}
    html,body{
      font:14px/1.35 system-ui,-apple-system,"Segoe UI",Roboto,Arial,
            "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji";
      -webkit-tap-highlight-color: transparent;
    }

    :root{
      --card-bg: rgba(255,255,255,.86); --card-border: rgba(0,0,0,.06);
      --title: #0f1b10; --pill-bg: rgba(84,116,75,.12); --pill-br: rgba(84,116,75,.28);
      --glass: rgba(255,255,255,.9); --glass-br: rgba(0,0,0,.08); --text: #0f1b10;
      --muted: #5b5f5b;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }
    body[data-theme="dark"]{
      --card-bg: rgba(22,24,27,.85); --card-border: rgba(255,255,255,.12);
      --title: #f3f5f1; --pill-bg: rgba(160,200,160,.14); --pill-br: rgba(190,230,190,.30);
      --glass: rgba(22,24,27,.9); --glass-br: rgba(255,255,255,.12); --text: #f3f5f1;
      --muted: #c9cdc8;
    }

    .collection-title{
      position:absolute; top:12px; left:50%; transform:translateX(-50%);
      background:var(--glass); color:var(--text); padding:8px 14px; border-radius:12px; border:1px solid var(--glass-br);
      z-index:6; max-width:80vw; overflow:hidden; text-overflow:ellipsis; font:600 16px/1.2 system-ui;
      white-space:nowrap;
    }

    .badge{
      position:absolute; z-index:9999; top:12px; left:12px;
      background:var(--glass);border:1px solid var(--glass-br);color:var(--text);
      border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);
      font:13px/1.2 system-ui;backdrop-filter: blur(4px);
    }
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--glass-br)}
    label{display:inline-flex;align-items:center;gap:8px;cursor:pointer}
    input[type="checkbox"]{width:18px;height:18px;accent-color:#567a58}

    .desktop-controls{ display:block; padding:8px 10px; }
    .desktop-controls .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .desktop-controls .row + .row{margin-top:6px}
    #filtersDetails{display:none}

    .achievements{
      position:absolute;top:12px;right:12px;z-index:10000;
      display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;max-width:46vw;
    }
    .ach-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--glass-br);font:12px/1.1 system-ui;box-shadow:0 2px 10px rgba(0,0,0,.06); white-space:nowrap;}
    .ach-emoji{font-size:14px}
    .ach-title{font-weight:600}

    .mapboxgl-popup-content{ background:transparent; padding:0; border-radius:20px; box-shadow:none }
    .mapboxgl-popup-tip{ display:none }
    .popup-card{
      position:relative; width:320px; max-width:92vw; border-radius:20px; overflow:hidden;
      background:var(--card-bg); border:1px solid var(--card-border); font:14px/1.35 system-ui
    }
    .popup-cover-box{ width:100%; height:200px; background:linear-gradient(180deg,#e7efe1,#f4f7f1) }
    .popup-cover{ width:100%; height:100%; object-fit:cover; display:block }
    .popup-body{ padding:14px }
    .popup-title{ font-weight:800; font-size:18px; margin:2px 0 6px; color:var(--title) }
    .row{margin:2px 0; display:flex; align-items:baseline; gap:8px}
    .row-emoji{width:1.2em; text-align:center}
    .meta{margin-bottom:6px;color:var(--muted)}
    .process-badge{
      position:absolute; top:10px; right:10px; z-index:2;
      font-size:12px; padding:6px 12px; border-radius:999px;
      border:1px solid transparent; background:rgba(255,255,255,.85);
      backdrop-filter: blur(2px);
    }

    @media (max-width:1024px){
      .collection-title{ max-width:70vw; }
      .popup-card{ width:360px; }
      .popup-cover-box{ height:220px; }
    }
    @media (max-width:680px){
      .collection-title{top:calc(8px + var(--safe-top));font-size:15px;max-width:72vw}

      .achievements{
        top:auto; bottom:calc(12px + var(--safe-bottom));
        right:calc(12px + var(--safe-right));
        left:auto;
        flex-wrap:wrap; overflow-x:visible; max-width:68vw;
        justify-content:flex-end;
      }

      .badge{
        top:auto; left:calc(12px + var(--safe-left));
        bottom:calc(12px + var(--safe-bottom));
        right:auto; padding:0; max-width:min(88vw, 420px);
      }
      .desktop-controls{display:none}
      #filtersDetails{display:block}
      #filtersDetails summary{
        padding:10px 12px;background:var(--glass);border-radius:14px;border:1px solid var(--glass-br);
        display:flex;align-items:center;gap:8px;cursor:pointer
      }
      #filtersDetails .panel{padding:10px 12px;border-top:1px solid var(--glass-br)}

      .mapboxgl-ctrl-bottom-right{bottom:calc(56px + var(--safe-bottom)) !important}
      .popup-card{ width:min(96vw, 520px); }
      .popup-cover-box{ height: 34vh; min-height: 160px; }
      .popup-title{ font-size:17px; }
      .process-badge{ font-size:12px; padding:6px 10px; }
    }
